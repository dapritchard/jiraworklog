#!/usr/bin/env python3

# from jira import JIRA
from jiraworklog.auth_jira import auth_jira
from jiraworklog.cmdline_args import parser
from jiraworklog.configuration import read_conf
from jiraworklog.confirm_updates import unconditional_updates, confirm_updates
from jiraworklog.sync_worklogs import sync_worklogs
from jiraworklog.read_checkedin_worklogs import confirm_new_checkedin, unconditional_new_checkedin
import sys

cmdline_args = parser.parse_args()
# TODO: this is also in `run_application.py`, let's extract it
if cmdline_args.auto_confirm:
    actions = {
        'confirm_new_checkedin': unconditional_new_checkedin,
        'confirm_updates': unconditional_updates
    }
else:
    actions = {
        'confirm_new_checkedin': confirm_new_checkedin,
        'confirm_updates': confirm_updates
    }
try:
    conf = read_conf(cmdline_args.config_path)
    jira = auth_jira(conf)
    sync_worklogs(jira, conf, cmdline_args, cmdline_args.file, actions, True)
except Exception as exc:
    sys.exit(str(exc))
